{"version":3,"file":"_server-539b4c82.js","sources":["../../../../src/routes/api/domains/[domain]/analytics/+server.js"],"sourcesContent":["import { generateLink, registerSite } from '$lib/plausible.js';\nimport { json } from '@sveltejs/kit';\nimport { getJWT } from '$lib/jwt.js';\nimport { DomainInfo } from '$lib/api.js';\nexport async function GET({ params, cookies }) {\n\tlet jwt = cookies.get('jwt');\n\tlet session = await getJWT(jwt);\n\tif (!session) return json({ error: 'User not signed in' }, 400);\n\n\tlet domain = params.domain;\n\tif (!domain) return json({ error: 'No domain provided' }, 400);\n\n\tlet domainInfo = await DomainInfo(domain);\n\tif (!domainInfo) return json({ error: 'No domain found' }, 400);\n\tif (domainInfo.error) return json({ error: domainInfo.error }, 400);\n\tconsole.log(domainInfo);\n\tif (domainInfo.owner.username.toLowerCase() !== session.user.login.toLowerCase())\n\t\treturn json({ error: 'You do not own this domain' }, 400);\n\n\tawait registerSite(domain);\n\tlet result2 = await generateLink(domain);\n\tif (!result2 || !result2.url) return json({ error: 'Failed to generate link' }, 400);\n\treturn json({ success: true, url: result2.url });\n}\n"],"names":[],"mappings":";;;;;;;;;AAIA,eAAA,GAAA,CAAA,EAAA,MAAA,EAAA,OAAA,EAAA,EAAA;AACA,EAAA,IAAA,GAAA,GAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,CAAA;AACA,EAAA,IAAA,OAAA,GAAA,MAAA,MAAA,CAAA,GAAA,CAAA,CAAA;AACA,EAAA,IAAA,CAAA,OAAA;AAAA,IAAA,OAAA,IAAA,CAAA,EAAA,KAAA,EAAA,oBAAA,EAAA,EAAA,GAAA,CAAA,CAAA;AAEA,EAAA,IAAA,MAAA,GAAA,MAAA,CAAA,MAAA,CAAA;AACA,EAAA,IAAA,CAAA,MAAA;AAAA,IAAA,OAAA,IAAA,CAAA,EAAA,KAAA,EAAA,oBAAA,EAAA,EAAA,GAAA,CAAA,CAAA;AAEA,EAAA,IAAA,UAAA,GAAA,MAAA,UAAA,CAAA,MAAA,CAAA,CAAA;AACA,EAAA,IAAA,CAAA,UAAA;AAAA,IAAA,OAAA,IAAA,CAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,EAAA,GAAA,CAAA,CAAA;AACA,EAAA,IAAA,UAAA,CAAA,KAAA;AAAA,IAAA,OAAA,IAAA,CAAA,EAAA,KAAA,EAAA,UAAA,CAAA,KAAA,EAAA,EAAA,GAAA,CAAA,CAAA;AACA,EAAA,OAAA,CAAA,GAAA,CAAA,UAAA,CAAA,CAAA;AACA,EAAA,IAAA,UAAA,CAAA,KAAA,CAAA,QAAA,CAAA,WAAA,EAAA,KAAA,OAAA,CAAA,IAAA,CAAA,KAAA,CAAA,WAAA,EAAA;AACA,IAAA,OAAA,IAAA,CAAA,EAAA,KAAA,EAAA,4BAAA,EAAA,EAAA,GAAA,CAAA,CAAA;AAEA,EAAA,MAAA,YAAA,CAAA,MAAA,CAAA,CAAA;AACA,EAAA,IAAA,OAAA,GAAA,MAAA,YAAA,CAAA,MAAA,CAAA,CAAA;AACA,EAAA,IAAA,CAAA,OAAA,IAAA,CAAA,OAAA,CAAA,GAAA;AAAA,IAAA,OAAA,IAAA,CAAA,EAAA,KAAA,EAAA,yBAAA,EAAA,EAAA,GAAA,CAAA,CAAA;AACA,EAAA,OAAA,IAAA,CAAA,EAAA,OAAA,EAAA,IAAA,EAAA,GAAA,EAAA,OAAA,CAAA,GAAA,EAAA,CAAA,CAAA;AACA;;;;"}